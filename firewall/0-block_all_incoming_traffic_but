#!/bin/bash

# Update and install UFW
sudo apt-get update
sudo apt-get install -y ufw

# Reset UFW (start with clean slate)
sudo ufw --force reset

# Set default policies
sudo ufw default deny incoming
sudo ufw default allow outgoing

# Allow the specified ports
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Important: Configure UFW to use DROP instead of REJECT
# This is what changes behavior from "closed" to "filtered"
sudo sed -i 's/DROP/DROP/g' /etc/default/ufw  # Ensure it's DROP
sudo sed -i 's/REJECT/DROP/g' /etc/default/ufw  # Change any REJECT to DROP
sudo sed -i 's/-j REJECT/-j DROP/g' /etc/ufw/before.rules
sudo sed -i 's/-j REJECT/-j DROP/g' /etc/ufw/after.rules

# Enable UFW
sudo ufw --force enable

# Verify UFW status
sudo ufw status verbose
